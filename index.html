<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ú–∏–Ω–∏‚Äë–∞–ø–ø ‚Äî —Ç–∞–±—ã + —Ç–∞–ø–∞–ª–∫–∞ (v10)</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root {
      --gap: 18px;
      --bg: #0a0a0a;          /* —Ç—ë–º–Ω—ã–π —Ñ–æ–Ω */
      --fg: #eaeaea;          /* —Å–≤–µ—Ç–ª—ã–π —Ç–µ–∫—Å—Ç */
      --accent: #ff3b30;      /* —Ü–≤–µ—Ç –∫–Ω–æ–ø–∫–∏ (–∫—Ä–∞—Å–Ω—ã–π) */
      --glass: rgba(255,255,255,.06);
      --glass-border: rgba(255,255,255,.25);
    }
    html, body { height: 100%; margin: 0; }
    * { -webkit-tap-highlight-color: transparent; }
    body {
      display: grid; place-items: center; background: var(--bg); color: var(--fg);
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
      user-select: none; overflow: hidden; position: relative;
      background-image:
        radial-gradient(1200px 600px at 50% 20%, rgba(255,255,255,.04), transparent 60%),
        radial-gradient(800px 800px at 80% 120%, rgba(255,255,255,.035), transparent 70%),
        repeating-linear-gradient(0deg, rgba(255,255,255,.03) 0px, rgba(255,255,255,.03) 1px, transparent 2px, transparent 3px);
      background-blend-mode: screen;
    }

    /* –≥–ª–æ–±–∞–ª—å–Ω–∞—è ¬´–≤–∞–ª—é—Ç–∞¬ª –≤–≤–µ—Ä—Ö—É —Å–ø—Ä–∞–≤–∞ */
    #wallet { position: fixed; top: 10px; right: 10px; z-index: 20; display: inline-flex; align-items: center; gap: 8px;
              padding: 6px 10px; font-size: 14px; background: var(--glass); border: 1px dashed var(--glass-border);
              border-radius: 10px; backdrop-filter: blur(2px); }
    #wallet img { display: block; width: 22px; height: 22px; object-fit: contain; }
    #balance { font-weight: 700; letter-spacing: .2px; }

    /* –∫–Ω–æ–ø–∫–∞ –æ–±–Ω—É–ª–µ–Ω–∏—è */
    #reset-btn {
      position: fixed; top: 10px; left: 10px; z-index: 20;
      padding: 6px 10px; font-size: 12px; letter-spacing: .3px; text-transform: lowercase;
      color: var(--fg); background: var(--glass);
      border: 1px dashed var(--glass-border); border-radius: 10px;
      backdrop-filter: blur(2px); cursor: pointer; outline: none; -webkit-appearance: none;
      transition: opacity .2s ease, transform .05s ease;
    }
    #reset-btn:focus, #reset-btn:focus-visible { outline: none; }
    #reset-btn:hover { opacity: .95; }
    #reset-btn:active { transform: translateY(1px); }

    /* —Å–ª–æ–π –¥–ª—è –∏—Å–∫—Ä */
    #fx-layer { position: fixed; inset: 0; pointer-events: none; overflow: hidden; z-index: 5; }

    main { width: 100%; max-width: 720px; padding: 24px 16px calc(88px + env(safe-area-inset-bottom, 0)); box-sizing: border-box; }

    .view { display: none; min-height: calc(100dvh - 140px); justify-items: center; align-content: center; gap: var(--gap); }
    .view.is-active { display: grid; }

    .btn {
      font-size: clamp(24px, 6vw, 44px);
      letter-spacing: 1px; text-transform: uppercase;
      padding: 26px 56px;
      border: 2px solid #111; border-radius: 18px;
      color: #fff; cursor: pointer; outline: none; -webkit-appearance: none;
      box-shadow: 0 10px 26px rgba(0,0,0,.35), inset 0 -3px rgba(0,0,0,.25);
      transition: transform .06s ease, filter .2s ease, background .2s ease;
      position: relative; background: var(--accent);
    }
    .btn:focus, .btn:focus-visible { outline: none; }
    .btn:active { transform: translateY(1px) scale(0.995); }

    .sticker { background: var(--glass); border: 1px dashed var(--glass-border); padding: 8px 12px; border-radius: 10px; backdrop-filter: blur(2px); transform: rotate(-1.25deg); }

    /* –Ω–∏–∂–Ω—è—è —Ç–∞–±‚Äë–ø–∞–Ω–µ–ª—å */
    .tabbar { position: fixed; z-index: 15; left: 0; right: 0; bottom: 0; padding: 10px 10px calc(10px + env(safe-area-inset-bottom, 0));
              display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; align-items: center;
              background: linear-gradient(180deg, rgba(0,0,0,0) 0%, rgba(0,0,0,.35) 25%, rgba(0,0,0,.55) 100%);
              backdrop-filter: blur(6px); border-top: 1px dashed var(--glass-border);
    }
    .tab { height: 46px; border-radius: 12px; border: 1px dashed var(--glass-border); background: var(--glass); color: var(--fg);
           font-size: 14px; letter-spacing: .4px; cursor: pointer; outline: none; -webkit-appearance: none; }
    .tab.is-active { background: rgba(255,255,255,.14); border-style: solid; }

    footer { position: fixed; bottom: 8px; left: 8px; font-size: 12px; opacity:.45; z-index: 16; }
  </style>
</head>
<body>
  <!-- –í–∞–ª—é—Ç–∞/–±–∞–ª–∞–Ω—Å –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É —Å –≤–∞—à–∏–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º -->
  <div id="wallet" aria-live="polite" title="–í–∞—à –±–∞–ª–∞–Ω—Å">
    <img id="wallet-icon" src="hand.png" alt="–∫–ª–∏–∫" />
    <span id="balance">0</span>
  </div>

  <button id="reset-btn" aria-label="–æ–±–Ω—É–ª–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å">–æ–±–Ω—É–ª–µ–Ω–∏–µ</button>
  <div id="fx-layer"></div>

  <main id="views">
    <!-- –¢–ê–ë 1: –ó–∞—Ä–∞–±–æ—Ç–∞—Ç—å (—Ç–∞–ø–∞–ª–∫–∞) -->
    <section id="tab-earn" class="view is-active" role="region" aria-labelledby="tabbtn-earn">
      <button id="hello-btn" class="btn" aria-label="–ø—Ä–∏–≤–µ—Ç">–ü–†–ò–í–ï–¢</button>
      <!-- –ø–æ–¥–ø–∏—Å—å —Å–æ —Å—á—ë—Ç—á–∏–∫–æ–º —É–¥–∞–ª–µ–Ω–∞: –±–∞–ª–∞–Ω—Å –≤–∏–¥–µ–Ω —Å–≤–µ—Ä—Ö—É —Å–ø—Ä–∞–≤–∞ -->
    </section>

    <!-- –¢–ê–ë–´‚Äë–∑–∞–≥–ª—É—à–∫–∏ -->
    <section id="tab-1" class="view" role="region" aria-labelledby="tabbtn-1">
      <p class="sticker">–†–∞–∑–¥–µ–ª 1 (—Å–∫–æ—Ä–æ)</p>
    </section>
    <section id="tab-2" class="view" role="region" aria-labelledby="tabbtn-2">
      <p class="sticker">–†–∞–∑–¥–µ–ª 2 (—Å–∫–æ—Ä–æ)</p>
    </section>
    <section id="tab-3" class="view" role="region" aria-labelledby="tabbtn-3">
      <p class="sticker">–†–∞–∑–¥–µ–ª 3 (—Å–∫–æ—Ä–æ)</p>
    </section>
  </main>

  <nav class="tabbar" role="tablist" aria-label="–ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Ä–∞–∑–¥–µ–ª–∞–º">
    <button class="tab is-active" id="tabbtn-earn" role="tab" aria-controls="tab-earn" data-tab="earn">–ó–∞—Ä–∞–±–æ—Ç–∞—Ç—å</button>
    <button class="tab" id="tabbtn-1" role="tab" aria-controls="tab-1" data-tab="1">1</button>
    <button class="tab" id="tabbtn-2" role="tab" aria-controls="tab-2" data-tab="2">2</button>
    <button class="tab" id="tabbtn-3" role="tab" aria-controls="tab-3" data-tab="3">3</button>
  </nav>

  <footer>v10</footer>

  <script>
    (function () {
      const tg = window.Telegram && Telegram.WebApp ? Telegram.WebApp : null;
      if (tg) { tg.ready(); tg.expand(); }

      // —ç–ª–µ–º–µ–Ω—Ç—ã
      const btn = document.getElementById('hello-btn');
      const fxLayer = document.getElementById('fx-layer');
      const resetBtn = document.getElementById('reset-btn');
      const balanceEl = document.getElementById('balance');
      const walletIcon = document.getElementById('wallet-icon');

      walletIcon?.addEventListener('error', () => {
        // –µ—Å–ª–∏ –∫–∞—Ä—Ç–∏–Ω–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, –∑–∞–º–µ–Ω—è–µ–º –Ω–∞ —ç–º–æ–¥–∑–∏
        walletIcon.replaceWith(Object.assign(document.createElement('span'), {textContent:'üëâ'}));
      });

      // —Ç–∞–±—ã
      const tabs = Array.from(document.querySelectorAll('.tabbar .tab'));
      const views = {
        earn: document.getElementById('tab-earn'),
        '1': document.getElementById('tab-1'),
        '2': document.getElementById('tab-2'),
        '3': document.getElementById('tab-3')
      };
      function switchTo(name){
        tabs.forEach(t => t.classList.toggle('is-active', t.dataset.tab === name));
        Object.entries(views).forEach(([k, v]) => v.classList.toggle('is-active', k === name));
      }
      tabs.forEach(t => t.addEventListener('click', () => switchTo(t.dataset.tab)));

      // —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å—á—ë—Ç—á–∏–∫–∞ (–≤–∞–ª—é—Ç–∞)
      const userId = tg?.initDataUnsafe?.user?.id ?? 'anon';
      const STORAGE_KEY = `tapper-count:${userId}`;
      let count = 0;
      try { const saved = localStorage.getItem(STORAGE_KEY); if (saved !== null) count = parseInt(saved, 10) || 0; } catch(_){}
      renderBalance();

      btn.addEventListener('click', (ev) => {
        spawnSparks(ev);
        count += 1;
        save();
        renderBalance();
      });

      resetBtn.addEventListener('click', () => {
        if (tg && typeof tg.showPopup === 'function') {
          tg.showPopup({
            title: '–û–±–Ω—É–ª–µ–Ω–∏–µ',
            message: '–°–±—Ä–æ—Å–∏—Ç—å –±–∞–ª–∞–Ω—Å –∫–ª–∏–∫–æ–≤?',
            buttons: [ { id:'yes', type:'destructive', text:'–°–±—Ä–æ—Å–∏—Ç—å' }, { type:'cancel' } ]
          }, (id) => { if (id === 'yes') doReset(); });
        } else {
          if (window.confirm('–°–±—Ä–æ—Å–∏—Ç—å –±–∞–ª–∞–Ω—Å –∫–ª–∏–∫–æ–≤?')) doReset();
        }
      });

      function doReset(){
        count = 0; save(); renderBalance();
        if (tg && typeof tg.showAlert === 'function') tg.showAlert('–ë–∞–ª–∞–Ω—Å: 0');
      }
      function save(){ try { localStorage.setItem(STORAGE_KEY, String(count)); } catch(_){}
      }
      function renderBalance(){ balanceEl.textContent = count; }

      // —ç—Ñ—Ñ–µ–∫—Ç –∏—Å–∫—Ä
      function spawnSparks(ev){
        const rect = btn.getBoundingClientRect();
        const cx = rect.left + rect.width/2;
        const cy = rect.top  + rect.height/2;
        const color = getComputedStyle(btn).backgroundColor || '#fff';
        const n = 18;
        for (let i=0;i<n;i++){
          const s = document.createElement('span');
          s.className = 'spark';
          const angle = (Math.PI * 2) * (i/n) + (Math.random()*0.5);
          const dist = 40 + Math.random()*70;
          const tx = Math.cos(angle) * dist + 'px';
          const ty = Math.sin(angle) * dist + 'px';
          const rot = (angle*180/Math.PI + (Math.random()*40-20)) + 'deg';
          const dur = (500 + Math.random()*500) + 'ms';
          s.style.left = (cx) + 'px';
          s.style.top  = (cy) + 'px';
          s.style.setProperty('--tx', tx);
          s.style.setProperty('--ty', ty);
          s.style.setProperty('--rot', rot);
          s.style.setProperty('--dur', dur);
          s.style.color = color;
          fxLayer.appendChild(s);
          s.addEventListener('animationend', ()=> s.remove());
        }
      }

      // —Å—Ç–∞—Ä—Ç—É–µ–º –Ω–∞ ¬´–ó–∞—Ä–∞–±–æ—Ç–∞—Ç—å¬ª
      switchTo('earn');
    })();
  </script>
</body>
</html>
