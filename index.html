<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Мини‑апп — уровни и счётчик (v5)</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
:root { --gap: 16px; }
html, body { height: 100%; margin: 0; }
* { -webkit-tap-highlight-color: transparent; }
body {
display: grid; place-items: center; background: #ffffff;
font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
color: #111; user-select: none;
}
main { display: grid; justify-items: center; gap: var(--gap); }
button.btn {
font-size: clamp(24px, 6vw, 42px);
padding: 24px 48px;
border: 2px solid #111; border-radius: 20px;
color: #fff; box-shadow: 0 8px 24px rgba(0,0,0,.15);
cursor: pointer; -webkit-appearance: none; outline: none; touch-action: manipulation;
transition: background .2s ease, transform .05s ease;
}
button.btn:focus, button.btn:focus-visible { outline: none; box-shadow: 0 8px 24px rgba(0,0,0,.15); }
button.btn::-moz-focus-inner { border: 0; }
button.btn:active { transform: translateY(1px); }


/* Цвета уровней */
.btn--red { background:#e53935; }
.btn--blue { background:#1e88e5; }
.btn--green { background:#43a047; }
.btn--yellow { background:#fdd835; color:#111; }


.counter { font-size: clamp(20px, 4vw, 26px); opacity: .95; margin-top: 6px; }
.hint { font-size: 12px; opacity: .55; }
footer { position: fixed; bottom: 8px; left: 8px; font-size: 12px; opacity:.5 }
</style>
</head>
<body>
<main>
<button id="hello-btn" class="btn btn--red" aria-label="привет">привет</button>
<p class="counter">Нажатий: <span id="count" aria-live="polite">0</span></p>
<p class="hint" id="goal"></p>
</main>
<footer>v5</footer>
<script>
(function () {
const tg = window.Telegram && Telegram.WebApp ? Telegram.WebApp : null;
if (tg) { tg.ready(); tg.expand(); }


// Уровни и цели
const LEVELS = ['red', 'blue', 'green', 'yellow'];
const TARGETS = { red: 10, blue: 50, green: 100, yellow: Infinity };


// Ключ сохранения (разный для каждого пользователя Telegram)
const userId = tg?.initDataUnsafe?.user?.id ?? 'anon';
const STORAGE_KEY = `hello-state:${userId}`;


// Элементы UI
const btn = document.getElementById('hello-btn');
const countEl = document.getElementById('count');
const goalEl = document.getElementById('goal');


// Состояние
let state = { level: 'red', count: 0 };
try {
const saved = localStorage.getItem(STORAGE_KEY);
if (saved) {
const parsed = JSON.parse(saved);
if (parsed && LEVELS.includes(parsed.level) && typeof parsed.count === 'number') {
state = parsed;
}
}
} catch (_) {}


function save() {
try { localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); } catch (_) {}
}


function applyLevel() {
btn.classList.remove('btn--red','btn--blue','btn--green','btn--yellow');
btn.classList.add(`btn--${state.level}`);
const target = TARGETS[state.level];
goalEl.textContent = state.level === 'yellow'
? 'Жёлтый уровень — кликай бесконечно.'
: `Цель на этом уровне: ${target}.`;
}


function render() { countEl.textContent = state.count; }


applyLevel();
render();


btn.addEventListener('click', () => {
state.count += 1;
const target = TARGETS[state.level];
if (state.count >= target) {
// достигли цели: обнуляем счётчик и повышаем уровень (если не жёлтый)
state.count = 0;
const idx = LEVELS.indexOf(state.level);
if (state.level !== 'yellow' && idx < LEVELS.length - 1) {
state.level = LEVELS[idx + 1];
applyLevel();
}
}
render();
save();
});
})();
</script>
</body>
</html>
