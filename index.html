<!DOCTYPE html>
<html lang="ру">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Мини‑апп — табы + тапалка (v9)</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root {
      --gap: 18px;
      --bg: #0a0a0a;          /* тёмный фон */
      --fg: #eaeaea;          /* светлый текст */
      --accent: #ff3b30;      /* цвет кнопки (красный) */
      --glass: rgba(255,255,255,.06);
      --glass-border: rgba(255,255,255,.25);
    }
    html, body { height: 100%; margin: 0; }
    * { -webkit-tap-highlight-color: transparent; }
    body {
      display: grid; place-items: center; background: var(--bg); color: var(--fg);
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
      user-select: none; overflow: hidden; position: relative;
      background-image:
        radial-gradient(1200px 600px at 50% 20%, rgba(255,255,255,.04), transparent 60%),
        radial-gradient(800px 800px at 80% 120%, rgba(255,255,255,.035), transparent 70%),
        repeating-linear-gradient(0deg, rgba(255,255,255,.03) 0px, rgba(255,255,255,.03) 1px, transparent 2px, transparent 3px);
      background-blend-mode: screen;
    }

    /* глобальная «валюта» вверху справа */
    #wallet { position: fixed; top: 10px; right: 10px; z-index: 20; display: inline-flex; align-items: center; gap: 8px;
              padding: 6px 10px; font-size: 14px; background: var(--glass); border: 1px dashed var(--glass-border);
              border-radius: 10px; backdrop-filter: blur(2px); }
    #wallet svg { display: block; width: 22px; height: 22px; }
    #balance { font-weight: 700; letter-spacing: .2px; }

    /* кнопка обнуления */
    #reset-btn {
      position: fixed; top: 10px; left: 10px; z-index: 20;
      padding: 6px 10px; font-size: 12px; letter-spacing: .3px; text-transform: lowercase;
      color: var(--fg); background: var(--glass);
      border: 1px dashed var(--glass-border); border-radius: 10px;
      backdrop-filter: blur(2px); cursor: pointer; outline: none; -webkit-appearance: none;
      transition: opacity .2s ease, transform .05s ease;
    }
    #reset-btn:focus, #reset-btn:focus-visible { outline: none; }
    #reset-btn:hover { opacity: .95; }
    #reset-btn:active { transform: translateY(1px); }

    /* слой для искр */
    #fx-layer { position: fixed; inset: 0; pointer-events: none; overflow: hidden; z-index: 5; }

    main { width: 100%; max-width: 720px; padding: 24px 16px calc(88px + env(safe-area-inset-bottom, 0)); box-sizing: border-box; }

    .view { display: none; min-height: calc(100dvh - 140px); justify-items: center; align-content: center; gap: var(--gap); }
    .view.is-active { display: grid; }

    .btn {
      font-size: clamp(24px, 6vw, 44px);
      letter-spacing: 1px; text-transform: uppercase;
      padding: 26px 56px;
      border: 2px solid #111; border-radius: 18px;
      color: #fff; cursor: pointer; outline: none; -webkit-appearance: none;
      box-shadow: 0 10px 26px rgba(0,0,0,.35), inset 0 -3px rgba(0,0,0,.25);
      transition: transform .06s ease, filter .2s ease, background .2s ease;
      position: relative; background: var(--accent);
    }
    .btn:focus, .btn:focus-visible { outline: none; }
    .btn:active { transform: translateY(1px) scale(0.995); }

    .sticker { background: var(--glass); border: 1px dashed var(--glass-border); padding: 8px 12px; border-radius: 10px; backdrop-filter: blur(2px); transform: rotate(-1.25deg); }

    /* нижняя таб‑панель */
    .tabbar { position: fixed; z-index: 15; left: 0; right: 0; bottom: 0; padding: 10px 10px calc(10px + env(safe-area-inset-bottom, 0));
              display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; align-items: center;
              background: linear-gradient(180deg, rgba(0,0,0,0) 0%, rgba(0,0,0,.35) 25%, rgba(0,0,0,.55) 100%);
              backdrop-filter: blur(6px); border-top: 1px dashed var(--glass-border);
    }
    .tab { height: 46px; border-radius: 12px; border: 1px dashed var(--glass-border); background: var(--glass); color: var(--fg);
           font-size: 14px; letter-spacing: .4px; cursor: pointer; outline: none; -webkit-appearance: none; }
    .tab.is-active { background: rgba(255,255,255,.14); border-style: solid; }

    footer { position: fixed; bottom: 8px; left: 8px; font-size: 12px; opacity:.45; z-index: 16; }
  </style>
</head>
<body>
  <!-- Валюта/баланс в правом верхнем углу -->
  <div id="wallet" aria-live="polite" title="Ваш баланс">
    <!-- Мини‑символ: палец нажимает красную кнопку -->
    <svg viewBox="0 0 64 64" aria-hidden="true">
      <!-- красная кнопка -->
      <circle cx="48" cy="16" r="10" fill="#ff3b30" stroke="#222" stroke-width="2"/>
      <!-- палец/рука -->
      <rect x="6" y="26" width="28" height="12" rx="6" fill="#f0d7b8" stroke="#222" stroke-width="2"/>
      <rect x="28" y="20" width="10" height="22" rx="6" fill="#f0d7b8" stroke="#222" stroke-width="2"/>
      <circle cx="40" cy="30" r="3" fill="#f0d7b8" stroke="#222" stroke-width="2"/>
      <!-- эффект нажатия -->
      <path d="M46 6 l4 -4 M48 28 l4 4 M58 16 l6 0 M32 16 l-6 0" stroke="#ff3b30" stroke-width="2"/>
    </svg>
    <span id="balance">0</span>
  </div>

  <button id="reset-btn" aria-label="обнулить прогресс">обнуление</button>
  <div id="fx-layer"></div>

  <main id="views">
    <!-- ТАБ 1: Заработать (тапалка) -->
    <section id="tab-earn" class="view is-active" role="region" aria-labelledby="tabbtn-earn">
      <button id="hello-btn" class="btn" aria-label="привет">ПРИВЕТ</button>
      <!-- Убрали подпись «Нажатий: …» в этом разделе -->
    </section>

    <!-- ТАБЫ‑заглушки -->
    <section id="tab-1" class="view" role="region" aria-labelledby="tabbtn-1">
      <p class="sticker">Раздел 1 (скоро)</p>
    </section>
    <section id="tab-2" class="view" role="region" aria-labelledby="tabbtn-2">
      <p class="sticker">Раздел 2 (скоро)</p>
    </section>
    <section id="tab-3" class="view" role="region" aria-labelledby="tabbtn-3">
      <p class="sticker">Раздел 3 (скоро)</p>
    </section>
  </main>

  <nav class="tabbar" role="tablist" aria-label="Навигация по разделам">
    <button class="tab is-active" id="tabbtn-earn" role="tab" aria-controls="tab-earn" data-tab="earn">Заработать</button>
    <button class="tab" id="tabbtn-1" role="tab" aria-controls="tab-1" data-tab="1">1</button>
    <button class="tab" id="tabbtn-2" role="tab" aria-controls="tab-2" data-tab="2">2</button>
    <button class="tab" id="tabbtn-3" role="tab" aria-controls="tab-3" data-tab="3">3</button>
  </nav>

  <footer>v9</footer>

  <script>
    (function () {
      const tg = window.Telegram && Telegram.WebApp ? Telegram.WebApp : null;
      if (tg) { tg.ready(); tg.expand(); }

      // элементы
      const btn = document.getElementById('hello-btn');
      const fxLayer = document.getElementById('fx-layer');
      const resetBtn = document.getElementById('reset-btn');
      const balanceEl = document.getElementById('balance');

      // табы
      const tabs = Array.from(document.querySelectorAll('.tabbar .tab'));
      const views = {
        earn: document.getElementById('tab-earn'),
        '1': document.getElementById('tab-1'),
        '2': document.getElementById('tab-2'),
        '3': document.getElementById('tab-3')
      };
      function switchTo(name){
        tabs.forEach(t => t.classList.toggle('is-active', t.dataset.tab === name));
        Object.entries(views).forEach(([k, v]) => v.classList.toggle('is-active', k === name));
      }
      tabs.forEach(t => t.addEventListener('click', () => switchTo(t.dataset.tab)));

      // состояние счётчика (валюта)
      const userId = tg?.initDataUnsafe?.user?.id ?? 'anon';
      const STORAGE_KEY = `tapper-count:${userId}`;
      let count = 0;
      try { const saved = localStorage.getItem(STORAGE_KEY); if (saved !== null) count = parseInt(saved, 10) || 0; } catch(_){}
      renderBalance();

      btn.addEventListener('click', (ev) => {
        spawnSparks(ev);
        count += 1;
        save();
        renderBalance();
      });

      resetBtn.addEventListener('click', () => {
        if (tg && typeof tg.showPopup === 'function') {
          tg.showPopup({
            title: 'Обнуление',
            message: 'Сбросить баланс кликов?',
            buttons: [ { id:'yes', type:'destructive', text:'Сбросить' }, { type:'cancel' } ]
          }, (id) => { if (id === 'yes') doReset(); });
        } else {
          if (window.confirm('Сбросить баланс кликов?')) doReset();
        }
      });

      function doReset(){
        count = 0; save(); renderBalance();
        if (tg && typeof tg.showAlert === 'function') tg.showAlert('Баланс: 0');
      }
      function save(){ try { localStorage.setItem(STORAGE_KEY, String(count)); } catch(_){} }
      function renderBalance(){ balanceEl.textContent = count; }

      // эффект искр
      function spawnSparks(ev){
        const rect = btn.getBoundingClientRect();
        const cx = rect.left + rect.width/2;
        const cy = rect.top  + rect.height/2;
        const color = getComputedStyle(btn).backgroundColor || '#fff';
        const n = 18;
        for (let i=0;i<n;i++){
          const s = document.createElement('span');
          s.className = 'spark';
          const angle = (Math.PI * 2) * (i/n) + (Math.random()*0.5);
          const dist = 40 + Math.random()*70;
          const tx = Math.cos(angle) * dist + 'px';
          const ty = Math.sin(angle) * dist + 'px';
          const rot = (angle*180/Math.PI + (Math.random()*40-20)) + 'deg';
          const dur = (500 + Math.random()*500) + 'ms';
          s.style.left = (cx) + 'px';
          s.style.top  = (cy) + 'px';
          s.style.setProperty('--tx', tx);
          s.style.setProperty('--ty', ty);
          s.style.setProperty('--rot', rot);
          s.style.setProperty('--dur', dur);
          s.style.color = color;
          fxLayer.appendChild(s);
          s.addEventListener('animationend', ()=> s.remove());
        }
      }

      // стартуем на «Заработать»
      switchTo('earn');
    })();
  </script>
</body>
</html>
